# 快取 (Caching) - 重點考題 (Quiz)

> 這份考題是從快取章節中挑選出**重要程度 4-5** 的核心題目，設計成自我測驗的形式。
> 
> **使用方式**：先嘗試自己回答問題，再展開「答案提示」核對重點，最後點擊連結查看完整解答。

---

## 📝 快取策略與模式

### Q1: 比較 Cache-Aside、Read-Through、Write-Through、Write-Back 四種快取策略

**難度**: ⭐⭐⭐⭐⭐⭐⭐⭐ (8) | **重要性**: 🔴 必考

請分別解釋這四種快取策略的運作流程，並說明各自的優缺點和適用場景。

<details>
<summary>💡 答案提示</summary>

**Cache-Aside (旁路快取)**：
- 應用程式控制快取邏輯
- 讀：先讀快取 → 未命中則讀 DB → 寫入快取
- 寫：先更新 DB → 再更新/刪除快取
- 最常見的模式

**Read-Through (讀穿透)**：
- 快取層自動從 DB 載入資料
- 應用只與快取互動
- 需快取提供者支援

**Write-Through (寫穿透)**：
- 寫入時同步更新快取和 DB
- 強一致性，但寫入延遲較高

**Write-Back (寫回)**：
- 只寫快取，異步寫 DB
- 寫入快，但有資料丟失風險

</details>

📖 [查看完整答案](../02_Backend_Development/Caching/cache_strategies_and_patterns.md)

---

### Q2: 什麼是快取穿透、擊穿、雪崩？如何解決？

**難度**: ⭐⭐⭐⭐⭐⭐⭐ (7) | **重要性**: 🔴 必考

這是快取面試的經典三連問，請完整說明三者的區別和解決方案。

<details>
<summary>💡 答案提示</summary>

**快取穿透 (Penetration)**：
- 現象：查詢不存在的資料，每次都打到 DB
- 原因：資料在快取和 DB 中都不存在
- 解法：**快取空值**、**布隆過濾器**

**快取擊穿 (Breakdown)**：
- 現象：熱點 Key 過期，大量請求同時打到 DB
- 原因：單一熱點資料失效
- 解法：**互斥鎖**、**永不過期 + 邏輯過期**

**快取雪崩 (Avalanche)**：
- 現象：大量 Key 同時過期或快取服務宕機
- 原因：大規模快取失效
- 解法：**過期時間隨機化**、**高可用叢集**、**服務降級熔斷**

| 問題 | 特徵 | 核心解法 |
|------|------|----------|
| 穿透 | 點攻擊 | 布隆過濾器 |
| 擊穿 | 線攻擊 | 互斥鎖 |
| 雪崩 | 面攻擊 | 隨機過期 |

</details>

📖 [查看完整答案](../02_Backend_Development/Caching/cache_penetration_breakdown_avalanche.md)

---

## 🔄 快取一致性

### Q3: 如何保證快取與資料庫的一致性？

**難度**: ⭐⭐⭐⭐⭐⭐⭐⭐ (8) | **重要性**: 🔴 必考

請解釋「先更新 DB 還是先更新快取」的問題，以及常見的一致性保證策略。

<details>
<summary>💡 答案提示</summary>

**常見問題場景**：
1. 先更新快取，後更新 DB → DB 更新失敗時不一致
2. 先更新 DB，後更新快取 → 並發時可能寫入舊值

**推薦策略：先更新 DB，再刪除快取**
- 避免了更新快取的並發問題
- 下次讀取時會重新載入最新資料

**延遲雙刪策略**：
1. 刪除快取
2. 更新資料庫
3. 延遲 N 毫秒後再次刪除快取
- 處理讀寫並發的髒資料問題

**其他方案**：
- 訂閱 Binlog (如 Canal) 異步更新快取
- 最終一致性 + 過期時間兜底

</details>

📖 [查看完整答案](../02_Backend_Development/Caching/distributed_cache_consistency.md)

---

## 📊 快取淘汰演算法

### Q4: 比較 LRU、LFU、FIFO 等快取淘汰演算法

**難度**: ⭐⭐⭐⭐⭐⭐ (6) | **重要性**: 🔴 必考

請解釋這些淘汰演算法的原理、優缺點，以及各自適合的場景。

<details>
<summary>💡 答案提示</summary>

| 演算法 | 原理 | 優點 | 缺點 | 適用場景 |
|--------|------|------|------|----------|
| **FIFO** | 先進先出 | 簡單 | 不考慮訪問頻率 | 簡單場景 |
| **LRU** | 淘汰最久未使用 | 常用、效果好 | 偶發大批量訪問會污染 | 一般快取 |
| **LFU** | 淘汰訪問頻率最低 | 保護高頻資料 | 實現複雜、冷啟動問題 | 熱點穩定場景 |
| **LRU-K** | 最近第 K 次訪問時間 | 解決 LRU 污染 | 更複雜 | 資料庫緩衝區 |

**Redis 淘汰策略**：
- `volatile-lru`：對設過期時間的 key 用 LRU
- `allkeys-lru`：對所有 key 用 LRU
- `volatile-lfu` / `allkeys-lfu`：使用 LFU

</details>

📖 [查看完整答案](../02_Backend_Development/Caching/cache_eviction_algorithms.md)

---

## 🏗️ 快取架構

### Q5: 什麼是延遲雙刪？什麼情況下需要使用？

**難度**: ⭐⭐⭐⭐⭐⭐⭐ (7) | **重要性**: 🟡 重要

請解釋延遲雙刪的原理和使用場景。

<details>
<summary>💡 答案提示</summary>

**問題背景**：
在「先更新 DB，再刪除快取」的策略下，如果有讀請求在 DB 更新前讀到舊值，並在快取刪除後寫入快取，會導致髒資料。

**延遲雙刪流程**：
1. 刪除快取
2. 更新資料庫
3. 等待一小段時間（如 500ms，需大於一次讀操作的時間）
4. 再次刪除快取

**使用場景**：
- 讀寫並發較高
- 對資料一致性要求較高
- 但又不想引入分散式事務

**注意事項**：
- 延遲時間需根據業務調整
- 可用 MQ 異步執行第二次刪除

</details>

📖 [查看完整答案](../02_Backend_Development/Caching/cache_warming_and_update_strategies.md)

---

### Q6: 如何設計多層快取架構？

**難度**: ⭐⭐⭐⭐⭐⭐⭐ (7) | **重要性**: 🟡 重要

請解釋 L1 (本地快取) + L2 (分散式快取) 的多層快取架構設計。

<details>
<summary>💡 答案提示</summary>

**多層快取結構**：

```
Client → L1 本地快取 → L2 分散式快取 → Database
         (Caffeine)     (Redis)
```

**L1 本地快取**：
- 速度極快（微秒級）
- 容量有限
- 各節點資料可能不一致
- 工具：Guava Cache、Caffeine

**L2 分散式快取**：
- 速度快（毫秒級）
- 容量大
- 資料一致
- 工具：Redis、Memcached

**一致性處理**：
- L2 更新時通知各節點更新 L1
- L1 設較短過期時間
- 使用 Pub/Sub 機制同步

</details>

📖 [查看完整答案](../02_Backend_Development/Caching/multi_tier_cache_architecture.md)

---

### Q7: CDN 快取的工作原理是什麼？

**難度**: ⭐⭐⭐⭐⭐⭐ (6) | **重要性**: 🟡 重要

請解釋 CDN 的快取機制、回源策略，以及如何設定快取控制。

<details>
<summary>💡 答案提示</summary>

**CDN 工作流程**：
1. 用戶請求 → 最近的 CDN 邊緣節點
2. 邊緣節點有快取 → 直接返回
3. 邊緣節點無快取 → 回源到源站
4. 返回資料並快取在邊緣節點

**快取控制標頭**：
- `Cache-Control: max-age=3600`
- `Cache-Control: no-cache` (需重新驗證)
- `Cache-Control: no-store` (不快取)
- `ETag` / `Last-Modified` (條件請求)

**CDN 快取刷新**：
- URL Purge：指定 URL 刷新
- Directory Purge：目錄刷新
- TTL 過期：自然過期

</details>

📖 [查看完整答案](../02_Backend_Development/Caching/cdn_and_edge_caching.md)

---

## 📊 學習進度檢核

完成以上題目後，請自我評估：

| 評估項目 | 自評 |
|----------|------|
| 能解釋四種快取讀寫策略 | ⬜ |
| 能區分穿透、擊穿、雪崩並給出解法 | ⬜ |
| 理解快取一致性問題和解決方案 | ⬜ |
| 能比較 LRU、LFU 等淘汰演算法 | ⬜ |
| 理解延遲雙刪的原理和使用場景 | ⬜ |
| 能設計多層快取架構 | ⬜ |
| 理解 CDN 快取機制 | ⬜ |

**建議**：未能完整回答的題目，請回到對應的詳細文章深入學習。
