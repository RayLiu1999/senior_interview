# 資料庫 (Databases) - 重點考題 (Quiz)

> 這份考題是從資料庫章節中挑選出**重要程度 4-5** 的核心題目，設計成自我測驗的形式。
> 
> **使用方式**：先嘗試自己回答問題，再展開「答案提示」核對重點，最後點擊連結查看完整解答。

---

## 📊 基礎概念

### Q1: SQL vs. NoSQL 該如何選擇？

**難度**: ⭐⭐⭐⭐⭐ (5) | **重要性**: 🔴 必考

請比較 SQL 和 NoSQL 資料庫的差異，並說明各自適合的使用場景。

<details>
<summary>💡 答案提示</summary>

**SQL 資料庫**：
- 結構化資料，固定 Schema
- 強一致性 (ACID)
- 支援複雜查詢和 JOIN
- 垂直擴展為主
- 適用：金融交易、ERP、關聯性強的資料

**NoSQL 資料庫**：
- 靈活 Schema，適合非結構化資料
- 最終一致性 (BASE)
- 水平擴展能力強
- 類型：Key-Value、文件型、列式、圖資料庫

**選擇依據**：
| 需求 | 選擇 |
|------|------|
| 複雜查詢、事務 | SQL |
| 高擴展性、靈活結構 | NoSQL |
| 關聯資料多 | SQL |
| 讀寫密集、簡單查詢 | NoSQL |

</details>

📖 [查看完整答案](../02_Backend_Development/Databases/sql_vs_nosql.md)

---

### Q2: 什麼是資料庫索引？解釋 B+ Tree 的原理

**難度**: ⭐⭐⭐⭐⭐⭐ (6) | **重要性**: 🔴 必考

請解釋索引的作用、類型，以及 B+ Tree 為何適合資料庫索引。

<details>
<summary>💡 答案提示</summary>

**索引的作用**：
- 加速資料檢索（空間換時間）
- 減少磁碟 I/O
- 但會增加寫入開銷

**索引類型**：
- 主鍵索引、唯一索引、普通索引
- 單列索引 vs 複合索引
- 聚簇索引 vs 非聚簇索引
- 覆蓋索引、全文索引

**B+ Tree 優勢**：
1. 所有資料存在葉子節點，範圍查詢高效
2. 葉子節點有指標連接，利於順序訪問
3. 樹高度低，減少磁碟 I/O（3-4 層可存數千萬筆）
4. 節點大小對應磁碟頁，利於批量讀取

**複合索引遵循最左匹配原則**

</details>

📖 [查看完整答案](../02_Backend_Development/Databases/database_indexing.md)

---

### Q3: 解釋 ACID 特性和隔離級別

**難度**: ⭐⭐⭐⭐⭐⭐ (6) | **重要性**: 🔴 必考

請解釋資料庫交易的 ACID 特性，以及四種隔離級別和它們解決的問題。

<details>
<summary>💡 答案提示</summary>

**ACID 特性**：
- **A (Atomicity)**：原子性，全部成功或全部失敗
- **C (Consistency)**：一致性，遵守完整性約束
- **I (Isolation)**：隔離性，並發事務互不干擾
- **D (Durability)**：持久性，提交後永久保存

**並發問題**：
| 問題 | 描述 |
|------|------|
| 髒讀 | 讀到未提交的資料 |
| 不可重複讀 | 同一筆資料讀兩次結果不同 |
| 幻讀 | 範圍查詢結果集變化 |

**隔離級別**：
| 級別 | 髒讀 | 不可重複讀 | 幻讀 |
|------|------|-----------|------|
| Read Uncommitted | ✗ | ✗ | ✗ |
| Read Committed | ✓ | ✗ | ✗ |
| Repeatable Read | ✓ | ✓ | ✗ |
| Serializable | ✓ | ✓ | ✓ |

**MySQL 預設 RR，PostgreSQL 預設 RC**

</details>

📖 [查看完整答案](../02_Backend_Development/Databases/database_transactions.md)

---

## 🔧 擴展與效能

### Q4: 什麼是資料庫分片 (Sharding)？有哪些策略？

**難度**: ⭐⭐⭐⭐⭐⭐⭐⭐ (8) | **重要性**: 🔴 必考

請解釋分片的概念、常見分片策略，以及各自的優缺點。

<details>
<summary>💡 答案提示</summary>

**分片類型**：
- **水平分片**：按行拆分到不同資料庫
- **垂直分片**：按列（功能）拆分

**水平分片策略**：

1. **Range Sharding (範圍分片)**
   - 按範圍分配（如 ID 1-1000 → Shard1）
   - 優點：簡單，範圍查詢高效
   - 缺點：資料分佈不均

2. **Hash Sharding (雜湊分片)**
   - hash(key) % N 決定分片
   - 優點：資料分佈均勻
   - 缺點：擴容困難，需重新分配

3. **Consistent Hashing (一致性雜湊)**
   - 解決擴容問題
   - 增減節點只影響相鄰分片

**分片挑戰**：
- 跨分片 JOIN 困難
- 分散式事務複雜
- 全域唯一 ID 生成
- 資料遷移和平衡

</details>

📖 [查看完整答案](../02_Backend_Development/Databases/database_sharding.md)

---

### Q5: 資料庫高可用方案有哪些？

**難度**: ⭐⭐⭐⭐⭐⭐⭐ (7) | **重要性**: 🔴 必考

請解釋主從複製、主主複製、讀寫分離等高可用方案。

<details>
<summary>💡 答案提示</summary>

**主從複製 (Master-Slave)**：
- 主庫處理寫入，從庫處理讀取
- 異步複製：效能好，可能丟資料
- 半同步複製：主庫等待至少一個從庫確認
- 同步複製：強一致，效能低

**主主複製 (Master-Master)**：
- 兩個主庫互相複製
- 需處理衝突問題
- 常用於異地多活

**讀寫分離**：
- 寫請求 → 主庫
- 讀請求 → 從庫（需處理延遲）

**高可用架構**：
- Keepalived + VIP：自動故障轉移
- MHA (MySQL)：自動主從切換
- MGR (MySQL Group Replication)：多主叢集
- Patroni (PostgreSQL)：自動故障轉移

</details>

📖 [查看完整答案](../02_Backend_Development/Databases/database_high_availability.md)

---

### Q6: 如何進行資料庫效能調優？

**難度**: ⭐⭐⭐⭐⭐⭐⭐⭐ (8) | **重要性**: 🔴 必考

請說明資料庫效能調優的主要方向和常見技巧。

<details>
<summary>💡 答案提示</summary>

**1. 索引優化**：
- 為高頻查詢欄位建索引
- 避免過度索引
- 使用複合索引並遵循最左匹配
- 使用 EXPLAIN 分析查詢

**2. 查詢優化**：
- 避免 SELECT *
- 避免在 WHERE 中使用函數
- 使用 LIMIT 限制結果集
- 避免 N+1 查詢問題

**3. Schema 設計**：
- 適當的正規化/反正規化
- 選擇合適的資料類型
- 合理設計分區

**4. 配置調優**：
- 緩衝池大小 (innodb_buffer_pool_size)
- 連接池設定
- 日誌參數調整

**5. 架構優化**：
- 讀寫分離
- 分庫分表
- 使用快取層

</details>

📖 [查看完整答案](../02_Backend_Development/Databases/database_performance_tuning.md)

---

### Q7: 什麼是讀寫分離？如何處理主從延遲？

**難度**: ⭐⭐⭐⭐⭐⭐ (6) | **重要性**: 🔴 必考

請解釋讀寫分離的架構和延遲問題的解決方案。

<details>
<summary>💡 答案提示</summary>

**讀寫分離架構**：
```
            寫入
Client ────────► Master (主庫)
                    │
                    │ 複製
                    ▼
            ┌──────┴──────┐
            ▼             ▼
         Slave1        Slave2  (從庫)
            ▲             ▲
            └──────┬──────┘
                讀取
```

**主從延遲問題**：
- 剛寫入的資料在從庫讀不到

**解決方案**：
1. **強制讀主**：關鍵業務讀主庫
2. **延遲讀取**：寫入後等待一段時間再讀
3. **半同步複製**：確保資料至少複製到一個從庫
4. **中間件路由**：記錄最近寫入，短時間內讀主
5. **Session 級別**：同一 Session 寫後讀走主庫

</details>

📖 [查看完整答案](../02_Backend_Development/Databases/read_write_splitting.md)

---

### Q8: 資料庫正規化的概念和適用場景

**難度**: ⭐⭐⭐⭐⭐⭐ (6) | **重要性**: 🟡 重要

請解釋正規化的目的和各層級，以及何時該反正規化。

<details>
<summary>💡 答案提示</summary>

**正規化目的**：
- 消除資料冗餘
- 維護資料一致性
- 減少更新異常

**常見正規形式**：
- **1NF**：欄位不可再分（原子性）
- **2NF**：消除部分依賴（非主鍵欄位完全依賴主鍵）
- **3NF**：消除傳遞依賴（非主鍵欄位不依賴其他非主鍵）
- **BCNF**：更嚴格的 3NF

**反正規化場景**：
- 讀多寫少，需要減少 JOIN
- 效能優先於儲存空間
- 資料不常變動

**例如**：在訂單表中冗餘商品名稱，避免每次 JOIN 商品表

</details>

📖 [查看完整答案](../02_Backend_Development/Databases/database_normalization.md)

---

### Q9: 資料庫遷移的策略和注意事項

**難度**: ⭐⭐⭐⭐⭐⭐⭐⭐ (8) | **重要性**: 🟡 重要

請說明如何進行零停機時間的資料庫遷移。

<details>
<summary>💡 答案提示</summary>

**遷移策略**：

1. **雙寫策略 (Dual Write)**
   - 同時寫入新舊資料庫
   - 逐步切換讀流量
   - 最終停止舊庫寫入

2. **CDC (Change Data Capture)**
   - 捕獲舊庫變更
   - 即時同步到新庫
   - 工具：Debezium、Canal

3. **藍綠部署**
   - 準備兩套環境
   - 資料同步後切換

**遷移步驟**：
1. 全量資料同步
2. 增量資料同步
3. 驗證資料一致性
4. 切換讀流量
5. 切換寫流量
6. 觀察穩定後下線舊庫

**注意事項**：
- 備份！備份！備份！
- 可回滾方案
- 驗證資料完整性

</details>

📖 [查看完整答案](../02_Backend_Development/Databases/database_migration_strategies.md)

---

## 📊 學習進度檢核

完成以上題目後，請自我評估：

| 評估項目 | 自評 |
|----------|------|
| 能比較 SQL vs NoSQL 並選型 | ⬜ |
| 理解索引原理和 B+ Tree | ⬜ |
| 能解釋 ACID 和隔離級別 | ⬜ |
| 理解分片策略和挑戰 | ⬜ |
| 能設計高可用資料庫架構 | ⬜ |
| 掌握資料庫效能調優方法 | ⬜ |
| 理解讀寫分離和延遲處理 | ⬜ |
| 了解正規化與反正規化 | ⬜ |
| 知道資料庫遷移策略 | ⬜ |

**建議**：未能完整回答的題目，請回到對應的詳細文章深入學習。
