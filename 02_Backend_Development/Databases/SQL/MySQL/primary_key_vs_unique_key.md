# 主鍵 (Primary Key) 和唯一鍵 (Unique Key) 有什麼區別？

- **難度**: 4
- **標籤**: `MySQL`, `SQL`, `Database Design`, `Constraints`

## 問題詳述

在資料庫表設計中，主鍵 (Primary Key) 和唯一鍵 (Unique Key) 都用於保證欄位中資料的唯一性。請詳細說明它們之間的核心區別、各自的用途以及何時該選擇使用哪一個。

## 核心理論與詳解

主鍵和唯一鍵是資料庫中兩種重要的約束 (Constraints)，它們對於維護資料的完整性和一致性至關重要。雖然它們都強制欄位的唯一性，但在許多方面存在顯著差異。

### 1. 主鍵 (Primary Key)

主鍵的核心使命是 **唯一地標識表中的每一行資料**。它就像是每一行記錄的「身分證號碼」，絕對不能重複，也絕對不能沒有。

- **核心特性**:
  - **唯一性 (Uniqueness)**: 主鍵欄位的值必須是唯一的，不允許有任何重複。
  - **非空性 (NOT NULL)**: 主鍵欄位的值 **絕對不允許為 `NULL`**。這是主鍵與唯一鍵最本質的區別之一。每一行都必須有一個明確的、非空的主鍵值。
  - **單一性**: 一個表 **最多只能有一個** 主鍵。
  - **組合鍵**: 主鍵可以由一個欄位組成，也可以由多個欄位組合而成（稱為複合主鍵或組合主鍵）。當由多個欄位組成時，是這些欄位的組合值必須唯一。

- **在 InnoDB 中的特殊作用**:
  - 在 MySQL 的 InnoDB 儲存引擎中，主鍵有著特殊的地位。InnoDB 使用主鍵來組織表的物理儲存結構，這種結構被稱為 **索引組織表 (Index-Organized Table, IOT)** 或 **叢集索引 (Clustered Index)**。
  - 這意味著表的資料行本身就是按照主鍵的順序進行物理儲存的。因此，通過主鍵進行的查詢效能非常高，因為資料庫可以直接定位到資料的物理位置。
  - 如果一個 InnoDB 表沒有明確定義主鍵，InnoDB 會自動尋找一個唯一的非空索引來作為叢集索引。如果連這樣的索引都沒有，InnoDB 會在內部隱式地創建一個 6 位元組長的 `ROW_ID` 作為主鍵。

- **用途**:
  - 作為表中每一行記錄的唯一標識符。
  - 作為外鍵 (Foreign Key) 的參照對象，用於建立表與表之間的關聯。

### 2. 唯一鍵 (Unique Key)

唯一鍵的主要目標是 **確保某個欄位或欄位組合的值不重複**，但它不像主鍵那樣承擔著「標識每一行」的重任。

- **核心特性**:
  - **唯一性 (Uniqueness)**: 與主鍵一樣，唯一鍵欄位的值也必須是唯一的。
  - **可為空 (NULLable)**: 這是與主鍵的關鍵區別。唯一鍵欄位 **允許包含 `NULL` 值**。更重要的是，在大多數資料庫系統中（包括 MySQL），你可以擁有多個值為 `NULL` 的行，因為 `NULL` 在 SQL 中不等於任何值，甚至不等於另一個 `NULL`。
  - **多樣性**: 一個表可以 **擁有多個** 唯一鍵。
  - **組合鍵**: 唯一鍵也可以是單一欄位或多個欄位的組合。

- **在 InnoDB 中的作用**:
  - 唯一鍵在 InnoDB 中會被創建為 **二級索引 (Secondary Index)**。
  - 二級索引的葉子節點儲存的不是指向資料行物理位置的指標，而是對應行的 **主鍵值**。
  - 因此，當使用唯一鍵進行查詢時，資料庫首先會在二級索引中找到對應的主鍵值，然後再通過主鍵值去叢集索引中查找完整的資料行。這個過程稱為 **回表 (Key Lookup)**。

- **用途**:
  - 當你需要保證某個欄位的唯一性，但這個欄位又不適合做主鍵時（例如，它可能包含 `NULL` 值，或者它不是記錄的核心標識）。
  - 例子：在一個使用者表中，`user_id` 是主鍵。`email` 和 `phone_number` 欄位也需要保持唯一，但它們可能允許使用者暫時不填寫（即為 `NULL`），這時就應該為 `email` 和 `phone_number` 分別建立唯一鍵。

### 總結對照表

| 特性 | 主鍵 (Primary Key) | 唯一鍵 (Unique Key) |
| :--- | :--- | :--- |
| **`NULL` 值** | **不允許** (NOT NULL) | **允許** (可以為 `NULL`) |
| **數量** | 一個表 **最多 1 個** | 一個表可以有 **多個** |
| **核心作用** | 唯一標識表中的每一行 | 確保欄位值的唯一性 |
| **InnoDB 索引** | **叢集索引** (Clustered Index) | **二級索引** (Secondary Index) |
| **查詢效能** | 通常更快（直接定位資料） | 可能需要回表（先查主鍵再查資料） |
| **候選鍵** | 是一種候選鍵 (Candidate Key) | 也是一種候選鍵 |

### 何時選擇？

- **選擇主鍵**:
  - 選擇一個能夠 **永久、唯一且穩定不變** 地標識每一行記錄的欄位。
  - 通常會使用無業務意義的自增 ID (`AUTO_INCREMENT`) 或 UUID 作為主鍵，因為業務相關的欄位（如身分證號、Email）未來可能會發生變更。

- **選擇唯一鍵**:
  - 當你需要為某個欄位強制執行唯一性約束，但它不適合做主key時。
  - 這些欄位通常是業務上的「備用鍵」，例如使用者 Email、手機號、產品序號等。
  - 這些欄位可能允許為 `NULL`。
