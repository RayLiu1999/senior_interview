# `DELETE`、`TRUNCATE` 和 `DROP` 指令的區別是什麼？

- **難度**: 3
- **重要程度**: 4
- **標籤**: `MySQL`, `SQL`, `DDL`, `DML`

## 問題詳述

在 SQL 中，`DELETE`、`TRUNCATE` 和 `DROP` 都可以用來刪除資料或資料庫物件，但它們在功能、效能和運作機制上有著本質的區別。請詳細闡述這三個指令的不同之處。

## 核心理論與詳解

理解這三個指令的區別對於資料庫的日常管理和維護至關重要，錯誤地使用它們可能會導致意想不到的後果，例如效能問題或不可逆的資料遺失。

### 1. `DELETE`

- **指令類型**: DML (Data Manipulation Language, 資料操作語言)。
- **操作對象**: 表中的 **一行或多行資料**。
- **運作原理**:
  - `DELETE` 是一行一行地從表中刪除資料。
  - 對於每一行被刪除的資料，它都會在交易日誌 (Transaction Log) 中記錄一條刪除記錄。這也是為什麼 `DELETE` 操作可以被回滾 (Rollback) 的原因。
  - 它會觸發表 (Table) 上定義的 `DELETE` 觸發器 (Triggers)。
  - 可以與 `WHERE` 子句結合使用，來精確刪除滿足特定條件的行。如果沒有 `WHERE` 子句，它會刪除表中的所有行。

- **語法**:

  ```sql
  DELETE FROM table_name WHERE condition;
  ```

- **核心特點**:
  - **可回滾**: `DELETE` 操作可以被 `ROLLBACK` 指令撤銷。
  - **逐行刪除**: 效能相對較低，特別是當刪除大量資料時，因為需要記錄大量日誌。
  - **觸發觸發器**: 如果表上有 `DELETE` 觸發器，會被觸發。
  - **不重設自動增長值**: 刪除所有資料後，表的自動增長 (Auto Increment) 計數器不會重設。新插入的資料會從之前的位置繼續增長。
  - **空間釋放**: `DELETE` 操作通常不會立即釋放磁碟空間，而是將被刪除的空間標記為「可重用」。

### 2. `TRUNCATE`

- **指令類型**: DDL (Data Definition Language, 資料定義語言)。雖然它操作資料，但在大多數資料庫系統中 (包括 MySQL)，它被歸類為 DDL，因為它隱含了對儲存結構的修改。
- **操作對象**: 表中的 **所有資料**。
- **運作原理**:
  - `TRUNCATE` 通過釋放儲存資料的資料頁 (Data Pages) 來快速刪除表中的所有資料。它不會逐行掃描和記錄日誌。
  - 由於其操作的底層性，它記錄的交易日誌非常少 (只記錄頁面的釋放)，因此執行速度非常快。
  - 它不能與 `WHERE` 子句一起使用，只能一次性清空整個表。
  - 它不會觸發 `DELETE` 觸發器。

- **語法**:

  ```sql
  TRUNCATE TABLE table_name;
  ```

- **核心特點**:
  - **通常不可回滾**: 在 MySQL 中，`TRUNCATE` 是一個隱含提交 (implicit commit) 的操作，執行後無法回滾。在其他一些資料庫 (如 SQL Server) 中，`TRUNCATE` 可以被回滾。
  - **效能極高**: 刪除大量資料時，速度遠快於 `DELETE`。
  - **不觸發觸發器**: 忽略所有 `DELETE` 觸發器。
  - **重設自動增長值**: `TRUNCATE` 會將表的自動增長計數器重設為初始值。
  - **立即釋放空間**: 操作會立即釋放大部分佔用的磁碟空間。

### 3. `DROP`

- **指令類型**: DDL (Data Definition Language, 資料定義語言)。
- **操作對象**: **整個資料庫物件**，例如表 (Table)、索引 (Index)、視圖 (View)、資料庫 (Database) 等。
- **運作原理**:
  - `DROP` 會徹底地、永久地刪除指定的資料庫物件。
  - 這不僅包括物件中的所有資料，還包括物件本身的定義 (結構)。
  - 例如，`DROP TABLE` 會刪除表的結構、所有資料、索引、觸發器、約束等所有相關資訊。

- **語法**:

  ```sql
  DROP TABLE table_name;
  DROP DATABASE database_name;
  ```

- **核心特點**:
  - **不可回滾**: `DROP` 是一個不可逆的操作。一旦執行，被刪除的物件無法恢復 (除非從備份中還原)。
  - **刪除定義和資料**: 徹底移除物件，而不僅僅是資料。
  - **釋放所有空間**: 立即釋放與該物件相關的所有磁碟空間。

### 總結對照表

| 特性 | `DELETE` | `TRUNCATE` | `DROP` |
| :--- | :--- | :--- | :--- |
| **指令類型** | DML | DDL | DDL |
| **操作目標** | 表中的行 (可選 `WHERE`) | 表中的所有行 | 整個表 (或資料庫等物件) |
| **回滾支援** | **可以** | **不可以** (在 MySQL 中) | **不可以** |
| **執行速度** | 慢 (逐行刪除) | 非常快 | 非常快 |
| **觸發器** | 觸發 `DELETE` 觸發器 | 不觸發 | 不觸發 |
| **自動增長值** | 不重設 | **重設** | 表不存在了，無此概念 |
| **空間釋放** | 不立即釋放 | **立即釋放** | **立即釋放** |
| **使用場景** | 刪除部分資料 | 清空整個表，但保留表結構 | 徹底刪除表及其結構 |

**簡單類比**:

- `DELETE`: 像是一頁一頁地撕掉書中的某些紙張。
- `TRUNCATE`: 像是保留書的封面，但把裡面所有的紙張一次性全部換成新的白紙。
- `DROP`: 像是把整本書連同封面一起扔進焚化爐。
