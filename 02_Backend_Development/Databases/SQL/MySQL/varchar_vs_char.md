# `VARCHAR` 和 `CHAR` 有什麼區別？

- **難度**: 2
- **重要程度**: 3
- **標籤**: `MySQL`, `Data Types`, `Schema Design`

## 問題詳述

在 MySQL 中，`VARCHAR` 和 `CHAR` 都是用來儲存字串的資料類型。請解釋這兩種類型在儲存方式、效能和空間使用上的核心區別，並說明在何種情況下應該選擇使用哪種類型。

## 核心理論與詳解

`VARCHAR` 和 `CHAR` 的選擇是資料庫結構設計中的一個基礎問題，它直接影響到儲存空間的效率和查詢效能。兩者的核心區別在於它們處理 **固定長度** 和 **可變長度** 字串的方式。

### `CHAR` (固定長度字串)

- **儲存方式**:
  - `CHAR(N)` 用於儲存固定長度的字串，其中 `N` 代表你想要儲存的字元數 (在 MySQL 中，`N` 的範圍是 0 到 255)。
  - 當你向 `CHAR(N)` 欄位插入一個長度小於 `N` 的字串時，MySQL 會在字串的 **右側填充空格**，使其長度達到 `N`。
  - 當你檢索這個值時，MySQL 預設會自動去除尾部的空格 (除非啟用了 `PAD_CHAR_TO_FULL_LENGTH` SQL 模式)。

- **空間使用**:
  - `CHAR` 類型是 **空間換時間** 的典型。它總是佔用 `N` 個字元所對應的固定位元組空間，無論實際儲存的字串有多長。
  - 這種方式的優點是內部儲存格式簡單，處理速度快。

- **範例**:
  - 假設有一個 `CHAR(10)` 的欄位。
  - 儲存 `'hello'`，實際上會儲存為 `'hello     '`，佔用 10 個字元的空間。
  - 儲存 `'world12345'`，佔用 10 個字元的空間。

### `VARCHAR` (可變長度字串)

- **儲存方式**:
  - `VARCHAR(N)` 用於儲存可變長度的字串，其中 `N` 代表你想要儲存的 **最大** 字元數 (在 MySQL 5.0.3 之後，`N` 的範圍是 0 到 65,535)。
  - `VARCHAR` 在儲存實際的字串資料之外，還需要使用 **1 到 2 個額外的位元組** 來記錄字串的實際長度。
    - 如果最大長度 `N` 小於等於 255，則使用 1 個位元組記錄長度。
    - 如果最大長度 `N` 大於 255，則使用 2 個位元組記錄長度。

- **空間使用**:
  - `VARCHAR` 類型是 **時間換空間** 的體現。它只佔用實際字串長度加上長度記錄位元組所需的空間。
  - 這種方式的優點是節省儲存空間，特別是當欄位值的長度差異很大時。

- **範例**:
  - 假設有一個 `VARCHAR(10)` 的欄位。
  - 儲存 `'hello'`，實際佔用 `5` (字串長度) + `1` (長度記錄) = 6 個位元組的空間。
  - 儲存 `'world12345'`，實際佔用 `10` (字串長度) + `1` (長度記錄) = 11 個位元組的空間。

### 核心區別對照表

| 特性 | `CHAR` | `VARCHAR` |
| :--- | :--- | :--- |
| **長度類型** | 固定長度 | 可變長度 |
| **空間分配** | 總是分配定義的完整長度空間 | 根據實際字串長度分配空間 |
| **空間效率** | 當字串長度接近定義長度時，效率高 | 當字串長度變化很大時，效率高 |
| **尾部空格** | 儲存時會用空格填充到定義長度 | 儲存時不會填充，直接儲存原字串 |
| **效能** | 處理速度通常更快，因為長度固定 | 處理速度可能稍慢，因為長度可變 |
| **額外開銷** | 無 | 1-2 位元組用於儲存長度資訊 |
| **最大長度** | 255 個字元 | 65,535 個位元組 (共享行大小限制) |

### 如何選擇？

選擇 `CHAR` 還是 `VARCHAR` 取決於具體的業務場景和資料特性：

1. **選擇 `CHAR` 的情況**:
    - **資料長度非常固定**: 當你確定某個欄位的值長度總是 (或幾乎總是) 一樣的。例如：
        - MD5 或 SHA1 雜湊值 (固定為 32 或 40 個字元)。
        - 性別欄位 (儲存 'M' 或 'F')。
        - 國家代碼 (如 'US', 'CN')。
        - UUID (固定長度)。
    - **資料長度很短**: 對於非常短的欄位 (例如 1-10 個字元)，即使長度可變，`CHAR` 的效能優勢和無長度位元組開銷也可能使其成為更好的選擇。
    - **追求極致的查詢效能**: 由於長度固定，`CHAR` 在處理更新和掃描時通常比 `VARCHAR` 更快，因為不需要動態計算行的大小。

2. **選擇 `VARCHAR` 的情況**:
    - **資料長度變化很大**: 這是最典型的使用場景。例如：
        - 使用者名稱、文章標題、評論內容。
        - URL 地址。
    - **欄位最大長度遠大於平均長度**: 如果一個欄位的最大長度設定為 2000，但大部分值的長度都在 50 以內，使用 `VARCHAR` 將極大地節省儲存空間。
    - **節省空間是首要考量**: 在大多數情況下，硬碟 I/O 是資料庫效能的主要瓶頸。節省儲存空間意味著可以用同樣的記憶體快取更多的資料，從而提高整體效能。

**總結**:
在現代的資料庫設計中，由於硬碟空間成本的降低和儲存引擎 (如 InnoDB) 的優化，`VARCHAR` 的使用變得越來越普遍。除非你遇到的場景非常符合 `CHAR` 的優勢 (長度極度固定且對效能有苛刻要求)，否則 **優先考慮使用 `VARCHAR`** 通常是一個更安全、更具擴展性的選擇。
