# 正向代理 vs 反向代理 (Proxy vs Reverse Proxy)

- **難度**: 5
- **重要程度**: 4
- **標籤**: `代理`, `Proxy`, `Reverse Proxy`, `Nginx`, `負載均衡`, `安全`

## 問題詳述

代理（Proxy）是一種位於客戶端與伺服器之間的中間層，用於轉發請求和回應。正向代理（Forward Proxy）和反向代理（Reverse Proxy）的核心差別在於**代理的服務對象**，這一差別衍生出完全不同的應用場景和安全模型。

## 核心理論與詳解

### 正向代理（Forward Proxy）

正向代理**代表客戶端**發出請求，伺服器只看到代理的 IP，**不知道真實客戶端的存在**。

```
客戶端 → [正向代理] → 目標伺服器
```

**典型場景**：
- **科學上網（VPN/翻牆）**：通過境外代理伺服器訪問被封鎖的網站
- **企業網路管控**：強制員工流量過代理，記錄和過濾訪問
- **匿名訪問**：隱藏客戶端真實 IP
- **緩存加速**：代理快取靜態資源，多個客戶端共用快取

**關鍵特徵**：
- 客戶端**主動配置**代理（瀏覽器設置代理地址）
- 伺服器端**不感知**代理的存在
- 代理對伺服器而言就是「客戶端」

---

### 反向代理（Reverse Proxy）

反向代理**代表伺服器**接收請求，客戶端只看到代理的 IP，**不知道後端真實伺服器的存在**。

```
客戶端 → [反向代理] → 後端伺服器群組
```

**典型場景**：
- **負載均衡**：將請求分發到多個後端伺服器（Round-robin、加權、一致性雜湊）
- **SSL 終止（SSL Termination）**：在代理層處理 TLS 加密/解密，後端通信使用 HTTP（卸載後端 CPU 壓力）
- **API 閘道（API Gateway）**：統一入口，處理認證、限流、路由
- **靜態資源快取**：快取後端回應，減輕後端壓力（CDN 的核心原理）
- **隱藏後端架構**：客戶端無法直接訪問後端服務，安全性更高
- **壓縮 & 協定轉換**：Nginx 接收 HTTP/2，轉發給後端 HTTP/1.1

**關鍵特徵**：
- 客戶端**無需配置**，對客戶端而言代理就是「伺服器」
- 後端伺服器可動態擴展，客戶端無感知
- 是構建高可用服務的標準基礎設施

---

### 核心對比

| 比較項目 | 正向代理 | 反向代理 |
|---------|---------|---------|
| 代理對象 | 客戶端（代表客戶端） | 伺服器（代表伺服器） |
| 哪方感知不到 | 目標伺服器不知道真實客戶端 | 客戶端不知道真實後端伺服器 |
| 需要配置 | 客戶端需主動配置代理 | 客戶端無需配置 |
| 典型工具 | Squid、HTTP Proxy、VPN | Nginx、HAProxy、Apache、Traefik |
| 主要用途 | 訪問控制、匿名、快取 | 負載均衡、SSL終止、安全、快取 |
| 隱藏誰 | 隱藏客戶端 | 隱藏後端伺服器 |

---

### 常見架構應用

**反向代理在現代後端架構中的位置**：

```
用客戶端 (Browser / Mobile)
    ↓  HTTPS
[CDN / 邊緣節點]（靜態資源快取）
    ↓  HTTPS
[Nginx / API Gateway]（反向代理層）
    ├── SSL 終止
    ├── 限流 / 認證
    └── 路由分發
         ├── 服務 A（訂單）
         ├── 服務 B（用戶）
         └── 服務 C（支付）
```

### 相關概念

- **透明代理（Transparent Proxy）**：客戶端無感知的正向代理（網路層強制攔截），常用於運營商或企業內網管控
- **SOCKS Proxy**：比 HTTP 代理更底層，工作在第 4 層（傳輸層），可代理任何協定（TCP/UDP）
- **Service Mesh Sidecar**：微服務中每個服務旁掛一個代理進程（如 Envoy），本質是每個服務的透明反向代理，實現流量管控、可觀測性
