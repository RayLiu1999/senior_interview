# 安全性測試 (Security Testing)

- **難度**: 8
- **重要程度**: 5
- **標籤**: `Testing`, `Security`, `Penetration Testing`, `Vulnerability`

## 問題詳述

什麼是安全性測試？它與一般的功能測試有何不同？在後端開發中，常見的安全性測試類型有哪些（如滲透測試、弱點掃描），以及如何將安全性思維融入開發生命週期 (DevSecOps)？

## 核心理論與詳解

安全性測試是一種旨在發現和修復軟體系統中安全漏洞的測試過程。與專注於“系統是否按預期工作”的功能測試不同，安全性測試的核心問題是：“系統能否被惡意地破壞或濫用？” 它的目標是主動識別系統的弱點，防止資料洩露、未經授權的訪問、服務中斷等安全事件。

### 安全性測試的關鍵類型

1. **弱點掃描 (Vulnerability Scanning)**：
    - **目標**：使用自動化工具掃描應用程式或基礎設施，以識別已知的安全漏洞。
    - **方法**：掃描器會根據一個包含數千個已知漏洞（如 OWASP Top 10）的數據庫來檢查系統。例如，檢查是否存在 SQL 注入、跨站腳本 (XSS)、過時的函式庫等。
    - **優點**：快速、自動化，能覆蓋大量已知問題。
    - **缺點**：容易產生誤報 (False Positives)，且無法發現未知的或業務邏輯層面的漏洞。

2. **滲透測試 (Penetration Testing / Pen-testing)**：
    - **目標**：模擬真實駭客的攻擊，嘗試利用系統中的漏洞來獲取訪問權限或竊取資料。
    - **方法**：由安全專家（“白帽駭客”）手動或結合工具進行。他們會嘗試各種攻擊向量，試圖繞過安全控制。
    - **類型**：
        - **黑箱測試 (Black-box)**：測試者對系統內部結構一無所知，完全模擬外部攻擊者。
        - **白箱測試 (White-box)**：測試者擁有完整的源代碼和架構文檔訪問權限，可以進行更深入的分析。
        - **灰箱測試 (Gray-box)**：介於兩者之間，測試者擁有部分資訊（如一個普通用戶帳號）。
    - **優點**：能發現複雜的、業務邏輯相關的漏洞，評估真實的風險。
    - **缺點**：成本高、耗時長，通常在開發後期或上線後進行。

3. **靜態應用程式安全測試 (SAST - Static Application Security Testing)**：
    - **目標**：在不運行代碼的情況下，分析源代碼、字節碼或二進制代碼，以發現潛在的安全缺陷。
    - **方法**：集成在 CI/CD 流程中，當開發者提交代碼時自動掃描。例如，檢測代碼中是否存在硬編碼的密碼、不安全的加密算法或潛在的注入點。
    - **優點**：能在開發早期發現問題，修復成本低。
    - **缺點**：無法理解運行時的上下文，可能產生誤報，且不能發現配置錯誤。

4. **動態應用程式安全測試 (DAST - Dynamic Application Security Testing)**：
    - **目標**：在應用程式運行時，從外部對其進行攻擊，模擬真實的攻擊行為。
    - **方法**：自動化工具向正在運行的應用程式發送惡意請求，並分析響應以確定是否存在漏洞。
    - **優點**：能發現運行時環境和配置相關的問題，誤報率較低。
    - **缺дендостатки**：無法定位到具體的代碼行，且覆蓋率可能有限。

### DevSecOps：將安全性融入開發流程

傳統上，安全性測試通常在開發週期的末尾進行，這導致修復成本高昂且可能延誤上線。**DevSecOps** 是一種文化和實踐，旨在將安全性無縫地集成到整個 DevOps 流程中，實現“安全左移 (Shift Left)”。

*   **計劃階段**：進行威脅建模 (Threat Modeling)，識別潛在的安全風險。
*   **開發階段**：
    - 為開發者提供安全編碼培訓。
    - 在 IDE 中集成安全插件。
    - 使用 **SAST** 工具在代碼提交時自動掃描。
*   **建構階段**：
    - 進行 **軟體組成分析 (SCA - Software Composition Analysis)**，掃描第三方依賴庫是否存在已知漏洞。
*   **測試階段**：
    - 將 **DAST** 工具集成到自動化測試流程中。
*   **部署與運營階段**：
    - 定期進行**滲透測試**和**弱點掃描**。
    - 部署 Web 應用防火牆 (WAF) 和入侵檢測系統 (IDS)。
    - 持續監控和日誌分析，及時響應安全事件。

## 程式碼範例 (可選)

安全性測試通常不涉及傳統的測試代碼，而是使用專門的工具。以下是一個概念性的例子，說明如何使用 Go 的 `sql` 包來防止 SQL 注入，這是 SAST 工具會檢查的一個點。

**不安全的寫法 (易受 SQL 注入攻擊):**

```go
// SAST 工具會標記此處為高風險
func GetUserUnsafe(db *sql.DB, username string) (*User, error) {
    // 直接將用戶輸入拼接到 SQL 查詢中
    query := fmt.Sprintf("SELECT * FROM users WHERE username = '%s'", username)
    // 如果 username 為 ' OR '1'='1，查詢將變為 SELECT * FROM users WHERE username = '' OR '1'='1'
    // 這會返回所有用戶，繞過了身份驗證
    rows, err := db.Query(query)
    // ...
}
```

**安全的寫法 (使用參數化查詢):**

```go
// SAST 工具會認為這是安全的
func GetUserSafe(db *sql.DB, username string) (*User, error) {
    // 使用 ? 作為佔位符，將用戶輸入作為參數傳遞
    // 數據庫驅動會對輸入進行轉義，防止惡意代碼執行
    query := "SELECT * FROM users WHERE username = ?"
    rows, err := db.Query(query, username)
    // ...
}
```

通過在開發流程早期引入 SAST 工具，團隊可以在代碼進入生產環境之前就識別並修復這類常見的安全漏洞。
