# ATDD (驗收測試驅動開發)

- **難度**: 7
- **重要程度**: 3
- **標籤**: `Testing`, `ATDD`, `BDD`, `Methodology`

## 問題詳述

什麼是驗收測試驅動開發 (ATDD)？它與 TDD (測試驅動開發) 和 BDD (行為驅動開發) 有何關係與區別？ATDD 的工作流程是怎樣的，它如何幫助團隊更好地對齊業務需求？

## 核心理論與詳解

驗收測試驅動開發 (ATDD) 是一種協作式的開發方法，它將團隊中的三種主要角色——客戶（或業務分析師）、開發者和測試者——聚集在一起，共同定義產品的驗收標準。這些驗收標準以自動化測試的形式編寫，並在開發實際功能之前完成。ATDD 的核心目標是確保團隊中的每個人對“完成”的定義有著共同的理解。

### ATDD、TDD 與 BDD 的關係

這三者都遵循“先寫測試”的理念，但其關注點和協作層面有所不同：

- **TDD (測試驅動開發)**：
    - **關注點**：**開發者視角**。主要關注程式碼的內部品質和設計。
    - **產出**：一系列的單元測試，用於驗證程式碼單元（如函數或類）的行為是否正確。
    - **誰來寫**：主要是開發者。
- **ATDD (驗收測試驅動開發)**：
    - **關注點**：**使用者視角**。關注系統的外部可見行為是否滿足使用者的需求和業務規則。
    - **產出**：一系列的驗收測試，用於驗證一個功能或使用者故事 (User Story) 是否已完成。
    - **誰來寫**：由“三方會談”（業務、開發、測試）共同定義，由開發者或測試者實現為自動化測試。
- **BDD (行為驅動開發)**：
    - **關注點**：**行為視角**。可以看作是 ATDD 的一種更精煉的實現方式。它使用一種半格式化的自然語言（如 Gherkin 語法：`Given-When-Then`）來描述系統的行為，使得測試本身即可作為活文檔。
    - **產出**：描述系統行為的規格說明，這些規格同時也是可執行的自動化測試。
    - **關係**：BDD 是從 TDD 演變而來，並與 ATDD 的理念高度重合。可以說，BDD 是實現 ATDD 的一種流行且結構化的方法。

**簡單總結**：
- TDD 確保我們“把事情做對”(build the thing right)。
- ATDD 確保我們“做了正確的事”(build the right thing)。
- BDD 則提供了一種通用的語言和框架來實踐 ATDD。

### ATDD 的工作流程

ATDD 通常遵循一個稱為“三方會談 (The Three Amigos)”的協作模式，並包含以下循環：

1. **討論 (Discuss)**：
    - 在開始一個使用者故事之前，業務代表、開發者和測試者一起開會。
    - 業務代表解釋需求和期望。
    - 開發者提出實現上的問題和邊界條件。
    - 測試者從測試的角度思考各種場景、負面案例和潛在風險。
    - 目標是澄清所有模糊不清的地方。
2. **提煉 (Distill)**：
    - 團隊將討論的結果提煉成具體的、可測試的**驗收標準**。
    - 這些標準通常以範例的形式呈現。例如：“如果使用者是 VIP 會員，結帳時應享有 9 折優惠。”
    - 如果使用 BDD，這些範例會被寫成 `Given-When-Then` 格式的場景。
3. **開發 (Develop)**：
    - 開發者將這些驗收標準轉化為**失敗的自動化驗收測試**。
    - 然後，開發者開始編寫剛好能讓這個測試通過的產品代碼。
    - 在這個過程中，開發者可能還會使用 TDD 來編寫更低層級的單元測試，以確保代碼的內部品質。
4. **演示 (Demo)**：
    - 一旦驗收測試通過，意味著功能已經根據共同定義的標準完成。
    - 團隊可以向業務代表演示這個功能，或者通過自動化測試報告來證明功能已完成。
    - 通過的驗收測試成為了系統行為的“活文檔 (Living Documentation)”。

### ATDD 的好處

1. **需求更清晰**：通過早期協作，團隊能在動手寫碼前就對需求達成共識，減少了後期因誤解而導致的返工。
2. **減少浪費**：只開發那些能滿足驗收標準的功能，避免過度設計或開發無人需要的功能。
3. **提升信心**：一套全面的自動化驗收測試為重構和添加新功能提供了強大的安全網。
4. **改善溝通**：打破了業務、開發和測試之間的壁壘，促進了跨職能團隊的協作。

ATDD 將測試從開發後期的“質量保證”活動，轉變為開發前期的“需求定義”活動，是實現敏捷和 DevOps 文化的重要實踐。
